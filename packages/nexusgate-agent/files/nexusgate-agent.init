#!/bin/sh /etc/rc.common
# NexusGate Agent init script

START=99
STOP=10

USE_PROCD=1

start_service() {
    local enabled
    config_load nexusgate
    config_get enabled settings enabled '0'

    [ "$enabled" = "1" ] || return 0

    procd_open_instance
    procd_set_param command /usr/bin/nexusgate-agent
    procd_set_param respawn 3600 5 5
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_close_instance
}

stop_service() {
    killall mosquitto_sub 2>/dev/null
}

service_triggers() {
    procd_add_reload_trigger "nexusgate"
}
